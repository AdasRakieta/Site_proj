function initHomeSettings(){const homeId=document.getElementById('home-data')?.dataset.homeId;if(!homeId){console.error('Home ID not found');return;}
const homeInfoForm=document.getElementById('homeInfoForm');if(homeInfoForm){homeInfoForm.addEventListener('submit',function(e){e.preventDefault();const formData=new FormData(this);const data={name:formData.get('name'),description:formData.get('description')};fetch(`/api/home/${homeId}/info/update`,{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(data)}).then(response=>response.json()).then(result=>{if(result.success){showNotification('Informacje o domu zostały zaktualizowane','success');}else{showNotification(result.error||'Wystąpił błąd podczas aktualizacji','error');}}).catch(error=>{console.error('Error:',error);showNotification('Wystąpił błąd podczas aktualizacji','error');});});}
const inviteUserForm=document.getElementById('inviteUserForm');if(inviteUserForm){inviteUserForm.addEventListener('submit',function(e){e.preventDefault();const formData=new FormData(this);const data={email:formData.get('email'),role:formData.get('role')};fetch(`/api/home/${homeId}/users/invite`,{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(data)}).then(response=>response.json()).then(result=>{if(result.success){showNotification('Zaproszenie zostało wysłane','success');this.reset();}else{showNotification(result.error||'Wystąpił błąd podczas wysyłania zaproszenia','error');}}).catch(error=>{console.error('Error:',error);showNotification('Wystąpił błąd podczas wysyłania zaproszenia','error');});});}}
function confirmDeleteHome(event){const button=event.currentTarget;const buttonText=document.getElementById('deleteHomeBtnText');const homeId=document.getElementById('home-data')?.dataset.homeId;const homeName=document.getElementById('home-data')?.dataset.homeName;if(!homeId){showNotification('Nie można znaleźć ID domu','error');return;}
if(button.classList.contains('confirm-state')){button.disabled=true;buttonText.textContent='Usuwanie...';fetch(`/api/home/${homeId}/delete`,{method:'DELETE',headers:{'Content-Type':'application/json',}}).then(response=>response.json()).then(result=>{if(result.success){showNotification('Dom został usunięty','success');setTimeout(()=>{window.location.href='/home/select';},2000);}else{showNotification(result.error||'Wystąpił błąd podczas usuwania domu','error');button.disabled=false;buttonText.textContent='Usuń dom';button.classList.remove('confirm-state');}}).catch(error=>{console.error('Error:',error);showNotification('Wystąpił błąd podczas usuwania domu','error');button.disabled=false;buttonText.textContent='Usuń dom';button.classList.remove('confirm-state');});}else{fetch(`/api/home/${homeId}/deletion-info`).then(response=>response.json()).then(result=>{if(result.success){const info=result.data;showNotification(`Usunięcie"${homeName}"usunie:${info.room_count}pokoi,${info.device_count}urządzeń,${info.user_count}użytkowników,${info.automation_count}automatyzacji.Kliknij ponownie aby potwierdzić.`,'warning');button.classList.add('confirm-state');buttonText.textContent='✓ Potwierdź usunięcie';setTimeout(()=>{if(button.classList.contains('confirm-state')){button.classList.remove('confirm-state');buttonText.textContent='Usuń dom';}},5000);}else{showNotification('Nie można pobrać informacji o domu','error');}}).catch(error=>{console.error('Error:',error);showNotification('Wystąpił błąd podczas pobierania informacji','error');});}}
document.addEventListener('DOMContentLoaded',initHomeSettings);