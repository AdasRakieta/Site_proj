document.addEventListener('DOMContentLoaded',function(){loadRoomsAndButtons();if(window.app&&app.socket){app.socket.emit('get_button_states');}});function loadRoomsAndButtons(){if(!window.app)return;Promise.all([app.fetchData('/api/rooms'),app.fetchData('/api/buttons')]).then(([rooms,buttons])=>{window.updateRoomsAndButtonsList(rooms,buttons);}).catch(error=>console.error('Error:',error));}
function toggleLight(room,buttonName,state){if(window.app&&app.socket){app.socket.emit('toggle_button',{room:room,name:buttonName,state:state});}}
window.toggleLight=toggleLight;if(window.app){app.onRoomsUpdate=function(rooms){app.fetchData('/api/buttons').then(buttons=>{window.updateRoomsAndButtonsList(rooms,buttons);}).catch(error=>console.error('Error:',error));};app.onButtonsUpdate=function(buttons){app.fetchData('/api/rooms').then(rooms=>{window.updateRoomsAndButtonsList(rooms,buttons);}).catch(error=>console.error('Error:',error));};app.onButtonStatesSync=function(states){for(const[key,state]of Object.entries(states)){const switchElement=document.getElementById(`${key.replace(/\s+/g,'_')}Switch`);if(switchElement){switchElement.checked=state;}}};}