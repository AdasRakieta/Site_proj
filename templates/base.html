<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SmartHome{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='icons/site_icon.png') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <script>
      (function() {
        try {
          var theme = localStorage.getItem('theme') || 'light';
          document.documentElement.setAttribute('data-theme', theme);
        } catch(e) {}
      })();
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block additional_styles %}{% endblock %}
</head>
<body>
    <div id="notifications-container"></div>
    
    <header>
        <button class="close-btn" onclick="toggleMenu()">
            <img id="menu-icon" src="{{ url_for('static', filename='icons/menu_icon_light.png') }}" alt="Menu Toggle" class="menu-toggle">
        </button>
        <h1>{% block header %}Strona Główna{% endblock %}</h1>
        <div style="position: absolute; top: 8px; right: 24px; display: flex; align-items: center; z-index: 1001;">
            {% if request.endpoint != 'login' %}
            <div id="user-avatar-dropdown" style="position: relative;">
                <img src="{{ user_data.profile_picture if user_data and user_data.profile_picture else url_for('static', filename='profile_pictures/admin_1747136465.png') }}"
                    alt="Profilowe" class="user-avatar" onclick="toggleUserMenu()">
                <div id="user-menu">
                    <div class="user-menu-info">
                        <div class="user-menu-username">{{ session.username if session.username else 'Gość' }}</div>
                        <div class="user-menu-role">Uprawnienia: {{ session.role if session.role else 'Brak roli' }}</div>
                    </div>
                    <a href="/user" class="user-menu-link">Profil użytkownika</a>
                    <a href="/settings" class="user-menu-link">Ustawienia</a>
                    <a href="/logout" class="user-menu-link logout">Wyloguj</a>
                </div>
            </div>
            {% endif %}
        </div>
    </header>
    

    <div id="sideMenu" class="side-menu">
        <button style="margin-top: 18px;" class="close-btn" onclick="toggleMenu()">
            <img id="menu-icon-side" src="{{ url_for('static', filename='icons/menu_icon_light.png') }}" alt="Menu Toggle" class="menu-toggle">
        </button>
        <nav style="margin-top: 55px;" class="menu">
            <ul>
                <li><a href="/" class="menu-link"><img id="home-icon" class="menu-icon" src="{{ url_for('static', filename='icons/home_icon_light.png') }}" alt="Home"> Strona Główna</a></li>
                <li><a href="/lights" class="menu-link"><img id="lights-icon" class="menu-icon" src="{{ url_for('static', filename='icons/lights_icon_light.png') }}" alt="Lights"> Światła</a></li>
                <li><a href="/temperature" class="menu-link"><img id="temperature-icon" class="menu-icon" src="{{ url_for('static', filename='icons/temperature_icon_light.png') }}" alt="Temperature"> Temperatura</a></li>
                <li><a href="/security" class="menu-link"><img id="security-icon" class="menu-icon" src="{{ url_for('static', filename='icons/security_icon_light.png') }}" alt="Security"> Zabezpieczenia</a></li>
                <li><a href="/automations" class="menu-link"><img id="automations-icon" class="menu-icon" src="{{ url_for('static', filename='icons/automations_icon_light.png') }}" alt="Automations"> Automatyzacje</a></li>
                {% if session.role == 'admin' %}
                <li><a href="/edit" class="menu-link"><img id="edit-icon" class="menu-icon" src="{{ url_for('static', filename='icons/edit_icon_light.png') }}" alt="Edit"> Edycja Przycisków</a></li>
                {% endif %}
                <li><a href="/settings" class="menu-link"><img id="settings-icon" class="menu-icon" src="{{ url_for('static', filename='icons/settings_icon_light.png') }}" alt="Settings"> Ustawienia</a></li>
            </ul>
        </nav>
    </div>

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/automations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/setup.js') }}"></script>
    <script src="{{ url_for('static', filename='js/user_menu.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>